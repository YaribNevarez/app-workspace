/*
 * joystick.cpp
 *
 *  Created on: Sep 19, 2017
 *      Author: root
 */

#include <stdio.h>
#include <string.h>
#include <fcntl.h>
#include <sys/ioctl.h>
#include <unistd.h>
#include <linux/joystick.h>
#include "joystick.hpp"


Joystick::Joystick(char * file_name):
	file_name(file_name),
	file_descriptor(-1),
	axis(NULL),
	buttons(NULL)
{
}

bool Joystick::open_device(void)
{
	if (!is_open())
	{
		file_descriptor = open((const char *)file_name.c_str(), O_RDONLY);
	}
	return is_open();
}

void Joystick::update_info(void)
{
	char name[128];
	ioctl(file_descriptor, JSIOCGNAME(128), &name);
	ioctl(file_descriptor, JSIOCGAXES, &number_of_axis);
	ioctl(file_descriptor, JSIOCGBUTTONS, &number_of_buttons);

	joystick_name = name;

	if (0 < number_of_axis)
	{
		axis = new int[number_of_axis];
		memset(axis, 0x0, sizeof(int) * number_of_axis);
	}

	if (0 < number_of_buttons)
	{
		buttons = new int[number_of_buttons];
		memset(buttons, 0x0, sizeof(int) * number_of_buttons);
	}
}

bool Joystick::is_open(void)
{
	return file_descriptor != -1;
}

void Joystick::close_device(void)
{
	close(file_descriptor);
	file_descriptor = -1;
}

std::string Joystick::get_name(void)
{
	return joystick_name;
}

unsigned Joystick::get_number_of_buttons(void)
{
	return number_of_buttons;
}

unsigned Joystick::get_number_of_axis(void)
{

}

int Joystick::get_axis_value(unsigned)
{

}

int Joystick::get_button_value(unsigned)
{

}
